T0G Tournament Bot â€“ Full System Overview (v1)

This document explains what every tournament file does, how the system works, and which files cause the bot/player issues. Use this as your personal reference.

1. Database Layer (Core)
tournament_db.py

Handles all DB operations.

Tables created:

tournaments
Stores tournament name, type, best_of, team_size, max_teams, captain_scoring, screenshot_proof, join panel info, teams_joined, players_joined, spectators_joined, category_id, panel message IDs.

teams
Stores team_name, role_id, captain_id, is_ready.

bracket_matches
Stores match brackets: team A, team B, round, winner, channel_id.

Functions:

get_tournament / upsert_tournament / delete_tournament

add_team / delete_team / set_team_ready / get_ready_teams / get_all_teams

clear_bracket / get_bracket_matches / insert_bracket_match / update_bracket_match

Impact:

DB is neutral. It treats bots and players the same.

Not the root cause of your bot/player problem.

2. Tournament Creation & Admin
tournament_cog.py

Starts tournaments with /create_tournament. Opens the CreateTournamentModal to set all initial config.

tournament_admin_panel.py

Creates the entire tournament category and all channels:

ğŸ·â”‚create-team

ğŸ§¾â”‚tournament-teams

ğŸ“œâ”‚tournament-rules

ğŸ“¢â”‚tournament-announcements

ğŸ’¬â”‚tournament-chat
Also stores category_id and panel message in DB.
Provides:

update_panel_message

refresh_join_panel_message
Handles DeleteTournamentModal.

Impact:

Not related to bot/player problem.

3. Team System (The Heart)
tournament_create_team_cog.py

Handles everything related to making and managing teams.

IMPORTANT FEATURES:

Create Team modal

Creates team role and team hub channel

Adds entry into teams table

Refreshes admin/join panels

Adds all team hub buttons

Team Hub Options:

Invites
Uses player role to DM invites. Accept adds team role; decline does nothing.

Ready
Counts team members by checking who has the team role.
Blocks Ready if not enough members.
Writes is_ready to DB.
Posts READY/NOT READY embed in tournament-teams.

Match Info
Placeholder for future match details.

Delete Team
Cleans messages in tournament-teams, removes roles, decrements teams_joined, removes from DB, deletes channel & role.

Impact:

Safe.

Only â€œsoftâ€ issue: Fake bots arenâ€™t real Discord members so they donâ€™t count as team members for readiness.

4. Join Panel & Player/Spectator System
join_panel_cog.py

Controls join/leave flow via big Join Panel message.

Features:

â€œJoin as Playerâ€

â€œSpectate Onlyâ€

â€œLeave Tournamentâ€

Adjusts players_joined/spectators_joined in DB

Saves join panel message & invite code

Refreshes join panel embed after any change

Impact:

No bot logic. Safe.

t_open_join_cog.py

Sets queue_status = OPEN.

t_close_join_cog.py

Sets queue_status = CLOSED.

5. Rules / Results / Announcements
tournament_rules_cog.py

Initializes rules channel and posts a rules template.

tournament_announcements_cog.py

Adds intro message to announcements channel.

tournament_results_cog.py

Creates match-results channel intro.

Impact:

Completely safe.

6. Settings Toggles
t_edit_settings_cog.py

Opens EditTournamentModal to update name, max teams, team size, etc.

t_captain_scoring_cog.py

Toggles captain scoring ON/OFF.

t_screenshot_proof_cog.py

Toggles screenshot-proof requirement.

t_toggle_bracket_cog.py

Switches Single/Double elimination.

t_delete_tournament_cog.py

Opens delete modal to wipe tournament.

Impact:

All safe.

7. Bracket System (The Most Complex)
tournament_bracket_cog.py

Handles seeding logic.

Currently broken because:

Tries to read from tournament_teams table, but the real table is teams.

Expects columns team_name, is_ready, is_bot which donâ€™t exist.

Fallback only sees channels inside the main category, but bot teams are in a separate category.
Result: Bot teams are never added to the bracket.

Impact:

Major culprit #1 for bot/player failing.

t_start_bracket_cog.py

Uses seeding from tournament_bracket_cog to:

Pair teams

Create match channels

Save matches into DB

Handle winner reporting

Move winners to the next round

Issues:

Relies on broken seeding from tournament_bracket_cog

Bots not seen in DB or seeding = no bot teams in bracket

Contains two functions named after_match_scored, second overwrites first and breaks image update

Impact:

Major culprit #2 (indirect)

8. Bot Testing System
test_bots_cog.py

Creates fake bot teams for bracket testing.

Problems:

Tries inserting into teams using wrong columns:
(guild_id, name, role_id, channel_id, is_bot_team)
but real table is:
(guild_id, team_id, team_name, role_id, captain_id, is_ready)

The insert always fails silently.

Also:

Bot channels are created in a completely different category than human teams

Bracket seeding never sees them

Impact:

Major culprit #3
Bots never enter the real teams table AND never appear in seeds.

9. Final Culprit Summary (Why bots â‰  players)

test_bots_cog.py
Wrong DB schema â†’ bot teams never saved.

tournament_bracket_cog.py
Uses wrong table names â†’ DB queries fail.
Fallback only sees one category â†’ bot channels ignored.

t_start_bracket_cog.py
Uses broken seeding â†’ bot teams never receive matches.

tournament_create_team_cog.py
Not a bug, but bots arenâ€™t real Discord members so they donâ€™t count toward readiness.

10. Recommended Fix Name

Call this entire document:

T0G Tournament Bot â€“ Full System Overview (v1)

Whenever youâ€™re ready, I can now:

Create a fix plan

Rewrite the broken cogs correctly

Convert bots into â€œreal playersâ€ in DB

Unify bracket seeding fully

Just tell me when you want the fix phase.